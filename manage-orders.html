<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Orders - Artios Academies Cafe</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #f8f9fa;
      color: #202124;
      line-height: 1.6;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      min-height: 100vh;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header {
      background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2em;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .header .subtitle {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .main-content {
      padding: 30px;
    }

    /* Order Lookup Form */
    .lookup-section {
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      text-align: center;
    }

    .lookup-section h3 {
      color: #1976d2;
      margin-bottom: 20px;
      font-size: 1.3em;
    }

    .lookup-form {
      display: flex;
      gap: 15px;
      max-width: 600px;
      margin: 0 auto;
      flex-wrap: wrap;
    }

    .form-group {
      flex: 1;
      min-width: 250px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
      text-align: left;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: #2196f3;
      box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
    }

    .lookup-btn {
      background: #2196f3;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      align-self: end;
    }

    .lookup-btn:hover {
      background: #1976d2;
      transform: translateY(-1px);
    }

    /* Order Display */
    .order-section {
      display: none;
    }

    .order-header {
      background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
      border: 2px solid #4caf50;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      text-align: center;
    }

    .order-id {
      font-size: 1.5em;
      font-weight: 700;
      color: #2e7d32;
      margin-bottom: 10px;
    }

    .order-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      color: #333;
    }

    /* Day Sections */
    .day-section {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .day-header {
      background: #2196f3;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .day-title {
      font-size: 1.2em;
      font-weight: 600;
    }

    .day-status {
      font-size: 0.9em;
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: 15px;
    }

    .day-status.can-cancel {
      background: #4caf50;
    }

    .day-status.locked {
      background: #ff5722;
    }

    .children-container {
      padding: 20px;
    }

    .child-section {
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .child-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .child-name {
      font-size: 1.1em;
      font-weight: 600;
      color: #1976d2;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .child-icon {
      background: #1976d2;
      color: white;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8em;
      font-weight: bold;
    }

    .item-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f9fa;
      padding: 12px 15px;
      border-radius: 8px;
      border-left: 4px solid #4caf50;
      transition: all 0.3s ease;
    }

    .order-item.cancelled {
      background: #ffebee;
      border-left-color: #f44336;
      opacity: 0.7;
    }

    .item-details {
      flex: 1;
    }

    .item-name {
      font-weight: 600;
      color: #333;
    }

    .item-price {
      color: #4caf50;
      font-weight: 600;
      font-size: 0.9em;
    }

    .cancel-btn {
      background: #ff5722;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .cancel-btn:hover {
      background: #d32f2f;
      transform: scale(1.05);
    }

    .cancel-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .cancelled-status {
      color: #f44336;
      font-weight: 600;
      font-size: 0.9em;
    }

    /* Refund Summary */
    .refund-summary {
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      border: 2px solid #ff9800;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      text-align: center;
    }

    .refund-amount {
      font-size: 1.5em;
      font-weight: 700;
      color: #f57c00;
      margin-bottom: 10px;
    }

    /* Status Messages */
    .status-message {
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      font-weight: 500;
    }

    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status-message.info {
      background: #e3f2fd;
      color: #1976d2;
      border: 1px solid #bbdefb;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #e0e0e0;
      border-top: 3px solid #2196f3;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Back Link */
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #1976d2;
      text-decoration: none;
      font-weight: 600;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .lookup-form {
        flex-direction: column;
      }

      .form-group {
        min-width: auto;
      }

      .order-details {
        grid-template-columns: 1fr;
      }

      .order-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .main-content {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìã Manage Your Orders</h1>
      <div class="subtitle">Cancel items, request refunds, or view order history</div>
    </div>

    <div class="main-content">
      <a href="index.html" class="back-link">‚Üê Back to Order Form</a>

      <!-- Order Lookup Section -->
      <div class="lookup-section">
        <h3>üîç Find Your Order</h3>
        <form class="lookup-form" id="lookup-form">
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" placeholder="parent@example.com" required>
          </div>
          <div class="form-group">
            <label for="order-id">Order ID (Optional)</label>
            <input type="text" id="order-id" placeholder="SMITH-0815-0730">
          </div>
          <button type="submit" class="lookup-btn">Find Orders</button>
        </form>
      </div>

      <!-- Order Display Section -->
      <div class="order-section" id="order-section">
        <div class="order-header">
          <div class="order-id" id="display-order-id">Order #SMITH-0815-0730</div>
          <div class="order-details">
            <div><strong>üìÖ Order Date:</strong> <span id="order-date">Aug 15, 2024</span></div>
            <div><strong>üë• Children:</strong> <span id="children-count">2</span></div>
            <div><strong>üí∞ Original Total:</strong> <span id="original-total">$47.25</span></div>
            <div><strong>üí≥ Payment:</strong> Venmo Confirmed</div>
          </div>
        </div>

        <!-- Days Container -->
        <div id="days-container">
          <!-- Days will be populated by JavaScript -->
        </div>

        <!-- Refund Summary -->
        <div class="refund-summary" id="refund-summary" style="display: none;">
          <div class="refund-amount">Total Refunds: $<span id="total-refunds">0.00</span></div>
          <p>Refunds will be processed via Venmo within 24 hours</p>
        </div>
      </div>

      <div class="status-message" id="status-message" style="display: none;"></div>
    </div>
  </div>

  <script>
    // Configuration
    const GOOGLE_SHEETS_CONFIG = {
      webAppUrl: 'https://script.google.com/macros/s/AKfycbxWSO9AKq5uWU7iReEoZcSx3Vn0oeL30ovCeTryKOmC2ze1kP-r7PhWBeAeIY4-82G3/exec'
    };

    document.addEventListener('DOMContentLoaded', function() {
      // Check URL parameters for direct access
      const urlParams = new URLSearchParams(window.location.search);
      const emailParam = urlParams.get('email');
      const orderParam = urlParams.get('order');

      if (emailParam) {
        document.getElementById('email').value = decodeURIComponent(emailParam);
      }
      if (orderParam) {
        document.getElementById('order-id').value = orderParam;
      }

      // Auto-submit if both parameters provided
      if (emailParam && orderParam) {
        setTimeout(() => {
          findOrders();
        }, 500);
      }

      // Setup form submission
      document.getElementById('lookup-form').addEventListener('submit', function(e) {
        e.preventDefault();
        findOrders();
      });
    });

    function findOrders() {
      const email = document.getElementById('email').value.trim();
      const orderId = document.getElementById('order-id').value.trim();

      if (!email) {
        showMessage('Please enter your email address', 'error');
        return;
      }

      showMessage('üîç Searching for your orders...', 'info');
      
      // Here you would call your Google Sheets API to find orders
      // For now, we'll simulate with sample data
      setTimeout(() => {
        displaySampleOrder();
      }, 1500);
    }

    function displaySampleOrder() {
      // Hide lookup section and show order
      document.querySelector('.lookup-section').style.display = 'none';
      document.getElementById('order-section').style.display = 'block';
      hideMessage();

      // Sample order data - this would come from your Google Sheets
      const orderData = {
        orderId: 'SMITH-0815-0730',
        orderDate: 'August 15, 2024',
        childrenCount: 2,
        originalTotal: 47.25,
        days: [
          {
            name: 'Monday',
            date: '2024-08-15',
            canCancel: false,
            children: [
              {
                name: 'Emma Smith',
                items: [
                  { id: '1', name: 'Chicken Sandwich', price: 6.50, cancelled: false },
                  { id: '2', name: 'Fries', price: 3.75, cancelled: false }
                ]
              },
              {
                name: 'Jake Smith', 
                items: [
                  { id: '3', name: 'Nuggets (8ct)', price: 6.50, cancelled: false }
                ]
              }
            ]
          },
          {
            name: 'Wednesday',
            date: '2024-08-17',
            canCancel: true,
            children: [
              {
                name: 'Emma Smith',
                items: [
                  { id: '4', name: 'Chicken Sandwich', price: 6.50, cancelled: false },
                  { id: '5', name: 'Fries', price: 3.75, cancelled: true }
                ]
              },
              {
                name: 'Jake Smith',
                items: [
                  { id: '6', name: 'Nuggets (8ct)', price: 6.50, cancelled: false }
                ]
              }
            ]
          }
        ]
      };

      renderOrder(orderData);
    }

    function renderOrder(orderData) {
      // Update header info
      document.getElementById('display-order-id').textContent = `Order #${orderData.orderId}`;
      document.getElementById('order-date').textContent = orderData.orderDate;
      document.getElementById('children-count').textContent = orderData.childrenCount;
      document.getElementById('original-total').textContent = `$${orderData.originalTotal.toFixed(2)}`;

      // Render days
      const daysContainer = document.getElementById('days-container');
      daysContainer.innerHTML = '';

      orderData.days.forEach(day => {
        const dayDiv = createDaySection(day);
        daysContainer.appendChild(dayDiv);
      });

      updateRefundSummary(orderData);
    }

    function createDaySection(day) {
      const dayDiv = document.createElement('div');
      dayDiv.className = 'day-section';

      const statusClass = day.canCancel ? 'can-cancel' : 'locked';
      const statusText = day.canCancel ? 'Can Cancel' : 'Locked';

      dayDiv.innerHTML = `
        <div class="day-header">
          <div class="day-title">${day.name}, ${new Date(day.date).toLocaleDateString()}</div>
          <div class="day-status ${statusClass}">${statusText}</div>
        </div>
        <div class="children-container">
          ${day.children.map((child, childIndex) => `
            <div class="child-section">
              <div class="child-name">
                <div class="child-icon">${childIndex + 1}</div>
                ${child.name}
              </div>
              <div class="item-list">
                ${child.items.map(item => `
                  <div class="order-item ${item.cancelled ? 'cancelled' : ''}">
                    <div class="item-details">
                      <div class="item-name">${item.name}</div>
                      <div class="item-price">$${item.price.toFixed(2)}</div>
                    </div>
                    ${item.cancelled ? 
                      '<div class="cancelled-status">CANCELLED</div>' : 
                      (day.canCancel ? 
                        `<button class="cancel-btn" onclick="cancelItem('${item.id}', '${item.name}', ${item.price})">Cancel Item</button>` :
                        '<button class="cancel-btn" disabled>Too Late</button>')
                    }
                  </div>
                `).join('')}
              </div>
            </div>
          `).join('')}
        </div>
      `;

      return dayDiv;
    }

    function cancelItem(itemId, itemName, itemPrice) {
      if (confirm(`Cancel ${itemName} for $${itemPrice.toFixed(2)}?\n\nThis will request a refund that will be processed within 24 hours.`)) {
        showMessage(`‚è≥ Cancelling ${itemName}...`, 'info');
        
        // Here you would call your Google Sheets API to process the cancellation
        setTimeout(() => {
          showMessage(`‚úÖ ${itemName} cancelled successfully! Refund of $${itemPrice.toFixed(2)} will be processed within 24 hours.`, 'success');
          
          // Update the UI to reflect cancellation
          const itemElement = document.querySelector(`button[onclick*="${itemId}"]`).closest('.order-item');
          itemElement.classList.add('cancelled');
          itemElement.querySelector('.cancel-btn').outerHTML = '<div class="cancelled-status">CANCELLED</div>';
          
          updateRefundSummary();
        }, 1000);
      }
    }

    function updateRefundSummary(orderData) {
      // Calculate total refunds (this would be more sophisticated in real implementation)
      const totalRefunds = 3.75; // Emma's cancelled fries
      
      if (totalRefunds > 0) {
        document.getElementById('total-refunds').textContent = totalRefunds.toFixed(2);
        document.getElementById('refund-summary').style.display = 'block';
      }
    }

    function showMessage(message, type) {
      const messageDiv = document.getElementById('status-message');
      messageDiv.textContent = message;
      messageDiv.className = `status-message ${type}`;
      messageDiv.style.display = 'block';
    }

    function hideMessage() {
      document.getElementById('status-message').style.display = 'none';
    }
  </script>
</body>
</html>
