<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafe Lunch Order Form 2025-2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f8f9fa;
            color: #202124;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2em;
            font-weight: 400;
            margin-bottom: 10px;
        }
        
        .header .notice {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            margin-top: 15px;
        }
        
        .sync-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            color: #333;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #34a853;
            animation: pulse 2s infinite;
        }
        
        .sync-indicator.offline {
            background: #fbbc04;
            animation: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .store-status {
            text-align: center;
            padding: 15px;
            margin: 20px 30px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .store-status.store-open {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        
        .store-status.store-closed {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            padding: 30px;
        }
        
        .form-section {
            background: white;
        }
        
        /* Shared Email Section */
        .shared-email {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .shared-email h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Child Section Styles */
        .child-section {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .child-section:hover {
            border-color: #4285f4;
        }
        
        .child-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .child-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #4285f4;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .child-icon {
            background: #4285f4;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .remove-child {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background 0.2s;
        }
        
        .remove-child:hover {
            background: #d32f2f;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #3c4043;
        }
        
        .required {
            color: #d93025;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 1px #4285f4;
        }
        
        .add-child-btn {
            background: white;
            color: #4285f4;
            border: 2px dashed #4285f4;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            margin-bottom: 30px;
            width: 100%;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .add-child-btn:hover {
            background: #f0f5ff;
            border-color: #1976d2;
            transform: translateY(-1px);
        }
        
        .menu-section {
            margin: 30px 0;
        }
        
        .menu-section h3 {
            margin-bottom: 20px;
            color: #3c4043;
            font-size: 1.2em;
        }
        
        .day-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .day-tab {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            min-width: 100px;
            text-align: center;
        }
        
        .day-tab:hover:not(.disabled) {
            border-color: #4285f4;
            transform: translateY(-1px);
        }
        
        .day-tab.active {
            background: #4285f4;
            color: white;
            border-color: #4285f4;
        }
        
        .day-tab.disabled {
            background: #f5f5f5;
            color: #9aa0a6;
            cursor: not-allowed;
            border-color: #e0e0e0;
            opacity: 0.7;
        }
        
        .day-tab.disabled:hover {
            border-color: #e0e0e0;
            transform: none;
        }
        
        .day-name {
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .day-date {
            font-size: 0.85em;
            margin-top: 2px;
            opacity: 0.9;
        }
        
        .menu-for-day {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .menu-for-day.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .menu-category {
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .category-title {
            background: #34a853;
            color: white;
            padding: 12px 15px;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .menu-items {
            border: 1px solid #e0e0e0;
            border-top: none;
        }
        
        .menu-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }
        
        .menu-item:last-child {
            border-bottom: none;
        }
        
        .menu-item:hover {
            background: #f8f9fa;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .item-name {
            font-weight: 500;
            color: #3c4043;
        }
        
        .item-price {
            font-weight: 600;
            color: #34a853;
            font-size: 1.1em;
        }
        
        .item-description {
            color: #5f6368;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .child-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .child-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f8f9fa;
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
        }
        
        .child-checkbox:hover {
            background: #e3f2fd;
            border-color: #4285f4;
        }
        
        .child-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .child-checkbox label {
            font-size: 0.9em;
            cursor: pointer;
            margin: 0;
        }
        
        .sidebar {
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        .cart-summary {
            background: white;
            border: 2px solid #4285f4;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(66,133,244,0.15);
        }
        
        .cart-title {
            color: #4285f4;
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .cart-items {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding-right: 5px;
        }
        
        .child-cart-section {
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4285f4;
        }
        
        .child-cart-header {
            font-weight: 600;
            color: #4285f4;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85em;
            padding: 2px 0;
        }
        
        .cart-item-name {
            flex: 1;
            margin-right: 10px;
        }
        
        .cart-item-price {
            font-weight: 600;
            color: #34a853;
        }
        
        .empty-cart {
            text-align: center;
            color: #9aa0a6;
            font-style: italic;
            padding: 20px;
        }
        
        .cart-total {
            border-top: 2px solid #4285f4;
            padding-top: 15px;
            text-align: center;
        }
        
        .total-label {
            font-size: 0.9em;
            color: #5f6368;
            margin-bottom: 5px;
        }
        
        .total-amount {
            font-size: 1.8em;
            font-weight: 600;
            color: #4285f4;
            margin-bottom: 15px;
        }
        
        .checkout-btn {
            width: 100%;
            background: #34a853;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 6px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .checkout-btn:hover:not(:disabled) {
            background: #2e7d32;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(52,168,83,0.3);
        }
        
        .checkout-btn:disabled {
            background: #dadce0;
            cursor: not-allowed;
            transform: none;
        }
        
        .history-btn {
            width: 100%;
            background: white;
            color: #4285f4;
            border: 1px solid #4285f4;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.2s;
        }
        
        .history-btn:hover {
            background: #f0f5ff;
        }
        
        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        
        .payment-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .payment-header {
            color: #4285f4;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .payment-amount {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .payment-steps {
            text-align: left;
            margin: 20px 0;
        }
        
        .payment-step {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .step-number {
            background: #4285f4;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
            font-size: 0.9em;
            flex-shrink: 0;
        }
        
        .venmo-btn {
            background: #3D95CE;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }
        
        .venmo-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(61,149,206,0.3);
        }
        
        .confirmation-btn {
            background: #34a853;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s;
        }
        
        .confirmation-btn:hover {
            background: #2e7d32;
        }
        
        .cancel-btn {
            background: #dadce0;
            color: #3c4043;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s;
        }
        
        .cancel-btn:hover {
            background: #c5c8cc;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000;
            max-width: 400px;
            animation: slideInRight 0.3s ease;
            font-size: 0.95em;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                order: -1;
            }
            
            .sync-status {
                position: static;
                margin: 10px auto;
                width: fit-content;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .day-tabs {
                overflow-x: scroll;
            }
            
            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="sync-status" id="sync-status">
                <div class="sync-indicator" id="sync-indicator"></div>
                <span id="sync-text">Cloud Sync Active</span>
            </div>
            <h1>🍽️ Cafe Lunch Order Form 2025-2026</h1>
            <div class="notice">
                <strong>Order & Payment Cutoff: Daily at 8:00 AM</strong><br>
                ONE FORM PER FAMILY • Order for multiple children with one email<br>
                Form closed daily from 8:00 AM - 1:00 PM<br>
                Contact: CRivers@artiosacademies.com
            </div>
        </div>
        
        <div class="store-status" id="store-status">
            Checking store hours...
        </div>
        
        <div class="main-content">
            <div class="form-section">
                <!-- Shared Email Section -->
                <div class="shared-email">
                    <h3>📧 Family Email</h3>
                    <div class="form-group">
                        <label for="family-email">Email Address <span class="required">*</span></label>
                        <input type="email" id="family-email" required placeholder="parent@example.com">
                    </div>
                </div>
                
                <!-- Children Sections -->
                <div id="children-container">
                    <div class="child-section" data-child="1">
                        <div class="child-header">
                            <div class="child-title">
                                <div class="child-icon">1</div>
                                Child 1
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>First Name <span class="required">*</span></label>
                                <input type="text" class="child-first-name" required>
                            </div>
                            <div class="form-group">
                                <label>Last Name <span class="required">*</span></label>
                                <input type="text" class="child-last-name" required>
                            </div>
                            <div class="form-group">
                                <label>Grade <span class="required">*</span></label>
                                <select class="child-grade" required>
                                    <option value="">Select Grade</option>
                                    <option value="K-2">K-2</option>
                                    <option value="3-4">3-4</option>
                                    <option value="5-6">5-6</option>
                                    <option value="7-8">7-8</option>
                                    <option value="9-12">9-12</option>
                                    <option value="Staff">Staff</option>
                                    <option value="Parent">Parent</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="button" class="add-child-btn" id="add-child-btn">
                    <span>➕</span> Add Another Child
                </button>
                
                <div class="menu-section">
                    <h3>Select Days & Menu Items</h3>
                    
                    <div class="day-tabs" id="day-tabs">
                        <!-- Tabs will be generated by JavaScript -->
                    </div>
                    
                    <div id="menu-container">
                        <!-- Menu for each day will be generated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="cart-summary">
                    <div class="cart-title">🛒 Your Order</div>
                    <button type="button" class="history-btn" id="history-btn">
                        View Order History
                    </button>
                    <div class="cart-items" id="cart-items">
                        <div class="empty-cart">No items selected</div>
                    </div>
                    <div class="cart-total">
                        <div class="total-label">Order Total</div>
                        <div class="total-amount">$<span id="total-amount">0.00</span></div>
                        <button type="button" class="checkout-btn" id="checkout-btn" disabled>
                            Review & Pay Order
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div class="payment-modal" id="payment-modal">
        <div class="payment-content">
            <div class="payment-header">Complete Your Order</div>
            <div class="payment-amount">
                Total: $<span id="modal-total">0.00</span>
            </div>
            
            <div class="payment-steps">
                <div class="payment-step">
                    <div class="step-number">1</div>
                    <div>Click "Pay with Venmo" to open Venmo with order details</div>
                </div>
                <div class="payment-step">
                    <div class="step-number">2</div>
                    <div>Complete payment to <strong>@ChanTa-Rivers</strong></div>
                </div>
                <div class="payment-step">
                    <div class="step-number">3</div>
                    <div>Return here and click "I've Paid" to submit your order</div>
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <a href="#" id="venmo-payment-link" class="venmo-btn">
                    💳 Pay with Venmo ($<span id="venmo-total">0.00</span>)
                </a>
            </div>
            
            <div style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                <button type="button" class="confirmation-btn" id="confirm-payment-btn">
                    ✅ I've Paid - Submit Order
                </button>
                <button type="button" class="cancel-btn" id="cancel-payment-btn">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const GOOGLE_SHEETS_CONFIG = {
            webAppUrl: 'https://script.google.com/macros/s/AKfycbxWSO9AKq5uWU7iReEoZcSx3Vn0oeL30ovCeTryKOmC2ze1kP-r7PhWBeAeIY4-82G3/exec',
            useGoogleSheets: true,
            fallbackToLocalStorage: true
        };
        
        // ============================================
        // STATE MANAGEMENT
        // ============================================
        let currentTotal = 0;
        let orderItems = [];
        let currentDay = 'monday';
        let storeIsOpen = true;
        let cloudSyncActive = false;
        let childCount = 1;
        
        // Menu data structure
        const menuData = {
            entrees: [
                { id: 'chicken-sandwich', name: 'Chicken Sandwich', price: 6.50, desc: 'Classic boneless breast of chicken' },
                { id: 'spicy-chicken', name: 'Spicy Chicken Sandwich', price: 6.75, desc: 'Boneless breast with spicy seasoning' },
                { id: 'nuggets-8', name: 'Nuggets (8ct)', price: 6.50, desc: 'Bite-sized boneless chicken pieces' },
                { id: 'grilled-nuggets', name: 'Grilled Nuggets (8ct)', price: 7.50, desc: 'Grilled boneless chicken pieces' },
                { id: 'grilled-sandwich', name: 'Grilled Sandwich', price: 8.25, desc: 'Grilled chicken breast sandwich' },
                { id: 'grilled-gf', name: 'Grilled Sandwich (GF Bun)', price: 9.50, desc: 'Grilled chicken with gluten-free bun' },
                { id: 'chicken-wrap', name: 'Chicken Wrap', price: 9.75, desc: 'Chicken with fresh vegetables in a wrap' },
                { id: 'veggie-wrap', name: 'Southwest Veggie Wrap', price: 9.50, desc: 'Fresh vegetables with southwest flavors' },
                { id: 'chicken-strips', name: 'Chicken Strips (3ct)', price: 6.75, desc: 'Hand-breaded chicken strips' }
            ],
            addons: [
                { id: 'chips-drink', name: 'Chips & Drink', price: 1.50, desc: 'Add to any entree' },
                { id: 'fries-drink', name: 'Fries & Drink', price: 3.75, desc: 'Add to any entree' },
                { id: 'fruit-drink', name: 'Fruit Cup & Drink', price: 5.50, desc: 'Add to any entree' },
                { id: 'mac-drink', name: 'Mac & Cheese & Drink', price: 5.50, desc: 'Add to any entree' },
                { id: 'salad-drink', name: 'Side Salad & Drink', price: 5.50, desc: 'Add to any entree' },
                { id: 'cookie-drink', name: 'Cookie Parfait & Drink', price: 5.75, desc: 'Add to any entree' }
            ],
            sides: [
                { id: 'fries-only', name: 'Fries', price: 3.75 },
                { id: 'fruit-only', name: 'Fruit Cup', price: 5.50 },
                { id: 'mac-only', name: 'Mac & Cheese', price: 5.50 },
                { id: 'salad-only', name: 'Side Salad', price: 5.50 },
                { id: 'cookie-only', name: 'Cookie Parfait', price: 5.75 }
            ],
            salads: [
                { id: 'cobb-salad', name: 'Cobb Salad', price: 11.25, desc: 'Mixed greens with chicken, bacon, cheese' },
                { id: 'southwest-salad', name: 'Southwest Salad', price: 11.50, desc: 'Mixed greens with southwest flavors' },
                { id: 'market-salad', name: 'Market Fresh Salad', price: 11.50, desc: 'Seasonal fresh vegetables and greens' }
            ]
        };
        
        const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
        const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
        
        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeDates();
            generateDayTabs();
            generateMenus();
            checkStoreHours();
            setupEventListeners();
            updateSyncStatus();
            updateChildCheckboxes();
            
            setInterval(checkStoreHours, 60000);
            
            if (GOOGLE_SHEETS_CONFIG.useGoogleSheets && GOOGLE_SHEETS_CONFIG.webAppUrl) {
                checkStoreStatusFromSheets();
                setInterval(checkStoreStatusFromSheets, 300000);
            }
        });
        
        function initializeDates() {
            const today = new Date();
            const currentDay = today.getDay();
            const monday = new Date(today);
            
            const diff = today.getDate() - currentDay + (currentDay === 0 ? -6 : 1);
            monday.setDate(diff);
            monday.setHours(0, 0, 0, 0);
            
            return monday;
        }
        
        function generateDayTabs() {
            const tabsContainer = document.getElementById('day-tabs');
            const monday = initializeDates();
            const now = new Date();
            const currentHour = now.getHours();
            
            let firstAvailableDay = null;
            
            days.forEach((day, index) => {
                const date = new Date(monday);
                date.setDate(monday.getDate() + index);
                
                const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                const todayOnly = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                const isToday = dateOnly.getTime() === todayOnly.getTime();
                const isBeforeToday = dateOnly.getTime() < todayOnly.getTime();
                
                const isPast = isBeforeToday || (isToday && currentHour >= 8);
                
                const tab = document.createElement('div');
                tab.className = 'day-tab';
                tab.dataset.day = day;
                
                if (isPast) {
                    tab.classList.add('disabled');
                } else if (!firstAvailableDay) {
                    firstAvailableDay = day;
                    tab.classList.add('active');
                    currentDay = day;
                }
                
                tab.innerHTML = `
                    <div class="day-name">${dayNames[index]}</div>
                    <div class="day-date">${date.getMonth() + 1}/${date.getDate()}</div>
                `;
                
                if (!isPast) {
                    tab.addEventListener('click', () => switchDay(day));
                }
                
                tabsContainer.appendChild(tab);
            });
            
            if (!firstAvailableDay) {
                document.getElementById('menu-container').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #5f6368;">
                        <h3>No days available for ordering this week</h3>
                        <p>Orders for next week will open on Monday at 1:00 PM</p>
                    </div>
                `;
            }
        }
        
        function generateMenus() {
            const container = document.getElementById('menu-container');
            
            days.forEach(day => {
                const dayDisplay = dayNames[days.indexOf(day)];
                const menuDiv = document.createElement('div');
                menuDiv.className = 'menu-for-day';
                menuDiv.dataset.day = day;
                if (day === currentDay) {
                    menuDiv.classList.add('active');
                }
                
                menuDiv.innerHTML = `
                    ${createCategoryHTML('Entrees', menuData.entrees, day, dayDisplay, false)}
                    ${createCategoryHTML('Add-Ons (Save $1.50!)', menuData.addons, day, dayDisplay, true)}
                    ${createCategoryHTML('Sides Only', menuData.sides, day, dayDisplay, false)}
                    ${createCategoryHTML('Salads', menuData.salads, day, dayDisplay, false)}
                `;
                
                container.appendChild(menuDiv);
            });
        }
        
        function createCategoryHTML(title, items, day, dayDisplay, isAddon) {
            const itemsHTML = items.map(item => {
                const uniqueId = `${item.id}-${day}`;
                const pricePrefix = isAddon ? '+$' : '$';
                const descHTML = item.desc ? `<div class="item-description">${item.desc}</div>` : '';
                
                return `
                    <div class="menu-item">
                        <div class="item-header">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">${pricePrefix}${item.price.toFixed(2)}</div>
                        </div>
                        ${descHTML}
                        <div class="child-checkboxes" id="${uniqueId}-checkboxes">
                            <!-- Child checkboxes will be generated here -->
                        </div>
                    </div>
                `;
            }).join('');
            
            return `
                <div class="menu-category">
                    <div class="category-title">${title}</div>
                    <div class="menu-items">
                        ${itemsHTML}
                    </div>
                </div>
            `;
        }
        
        function switchDay(day) {
            document.querySelectorAll('.day-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.day === day && !tab.classList.contains('disabled')) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('.menu-for-day').forEach(menu => {
                menu.classList.remove('active');
                if (menu.dataset.day === day) {
                    menu.classList.add('active');
                }
            });
            
            currentDay = day;
        }
        
        // ============================================
        // MULTI-CHILD FUNCTIONALITY
        // ============================================
        function setupEventListeners() {
            document.getElementById('add-child-btn').addEventListener('click', addChild);
            
            document.addEventListener('change', function(e) {
                if (e.target.type === 'checkbox' && e.target.dataset.item) {
                    updateCart();
                }
            });
            
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('child-first-name') || 
                    e.target.classList.contains('child-last-name')) {
                    updateChildCheckboxes();
                }
                if (e.target.id === 'family-email') {
                    checkOrderHistory();
                }
                validateForm();
            });
            
            document.getElementById('checkout-btn').addEventListener('click', openPaymentModal);
            document.getElementById('history-btn').addEventListener('click', showOrderHistory);
            document.getElementById('cancel-payment-btn').addEventListener('click', closePaymentModal);
            document.getElementById('confirm-payment-btn').addEventListener('click', submitOrder);
            
            document.getElementById('payment-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closePaymentModal();
                }
            });
        }
        
        function addChild() {
            childCount++;
            const container = document.getElementById('children-container');
            
            const childSection = document.createElement('div');
            childSection.className = 'child-section';
            childSection.dataset.child = childCount;
            
            childSection.innerHTML = `
                <div class="child-header">
                    <div class="child-title">
                        <div class="child-icon">${childCount}</div>
                        Child ${childCount}
                    </div>
                    <button type="button" class="remove-child" onclick="removeChild(${childCount})">
                        Remove
                    </button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name <span class="required">*</span></label>
                        <input type="text" class="child-first-name" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name <span class="required">*</span></label>
                        <input type="text" class="child-last-name" required>
                    </div>
                    <div class="form-group">
                        <label>Grade <span class="required">*</span></label>
                        <select class="child-grade" required>
                            <option value="">Select Grade</option>
                            <option value="K-2">K-2</option>
                            <option value="3-4">3-4</option>
                            <option value="5-6">5-6</option>
                            <option value="7-8">7-8</option>
                            <option value="9-12">9-12</option>
                            <option value="Staff">Staff</option>
                            <option value="Parent">Parent</option>
                        </select>
                    </div>
                </div>
            `;
            
            container.appendChild(childSection);
            updateChildCheckboxes();
            
            childSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        function removeChild(childId) {
            const childSection = document.querySelector(`[data-child="${childId}"]`);
            if (childSection && document.querySelectorAll('.child-section').length > 1) {
                childSection.remove();
                
                orderItems = orderItems.filter(item => item.childId !== childId);
                
                renumberChildren();
                updateChildCheckboxes();
                updateCart();
            }
        }
        
        function renumberChildren() {
            const childSections = document.querySelectorAll('.child-section');
            childCount = childSections.length;
            
            childSections.forEach((section, index) => {
                const newChildId = index + 1;
                section.dataset.child = newChildId;
                section.querySelector('.child-icon').textContent = newChildId;
                section.querySelector('.child-title').lastChild.textContent = ` Child ${newChildId}`;
                const removeBtn = section.querySelector('.remove-child');
                if (removeBtn) {
                    removeBtn.setAttribute('onclick', `removeChild(${newChildId})`);
                }
            });
        }
        
        function updateChildCheckboxes() {
            const children = document.querySelectorAll('.child-section');
            
            document.querySelectorAll('.child-checkboxes').forEach(container => {
                const parts = container.id.split('-');
                const day = parts[parts.length - 2];
                const itemId = parts.slice(0, -2).join('-');
                
                container.innerHTML = '';
                
                children.forEach(child => {
                    const childId = child.dataset.child;
                    const firstName = child.querySelector('.child-first-name').value || `Child ${childId}`;
                    
                    const checkboxContainer = document.createElement('div');
                    checkboxContainer.className = 'child-checkbox';
                    
                    const checkboxId = `${itemId}-${day}-child-${childId}`;
                    
                    checkboxContainer.innerHTML = `
                        <input type="checkbox" 
                               id="${checkboxId}"
                               data-item="${itemId}"
                               data-day="${day}"
                               data-child-id="${childId}">
                        <label for="${checkboxId}">${firstName}</label>
                    `;
                    
                    container.appendChild(checkboxContainer);
                });
            });
        }
        
        // ============================================
        // CART MANAGEMENT
        // ============================================
        function updateCart() {
            orderItems = [];
            currentTotal = 0;
            
            const checkedBoxes = document.querySelectorAll('input[type="checkbox"]:checked');
            
            checkedBoxes.forEach(checkbox => {
                const itemId = checkbox.dataset.item;
                const day = checkbox.dataset.day;
                const childId = checkbox.dataset.childId;
                const childSection = document.querySelector(`[data-child="${childId}"]`);
                const firstName = childSection.querySelector('.child-first-name').value || `Child ${childId}`;
                const lastName = childSection.querySelector('.child-last-name').value || '';
                const grade = childSection.querySelector('.child-grade').value || '';
                
                // Find the menu item
                let menuItem = null;
                Object.values(menuData).forEach(category => {
                    const item = category.find(i => i.id === itemId);
                    if (item) menuItem = item;
                });
                
                if (menuItem) {
                    orderItems.push({
                        id: `${itemId}-${day}-${childId}`,
                        childId: childId,
                        childName: `${firstName} ${lastName}`.trim(),
                        firstName: firstName,
                        lastName: lastName,
                        grade: grade,
                        name: menuItem.name,
                        price: menuItem.price,
                        day: dayNames[days.indexOf(day)]
                    });
                    currentTotal += menuItem.price;
                }
            });
            
            displayCart();
            validateForm();
        }
        
        function displayCart() {
            const cartItemsDiv = document.getElementById('cart-items');
            const totalSpan = document.getElementById('total-amount');
            
            if (orderItems.length === 0) {
                cartItemsDiv.innerHTML = '<div class="empty-cart">No items selected</div>';
                totalSpan.textContent = '0.00';
                return;
            }
            
            // Group by child
            const itemsByChild = {};
            orderItems.forEach(item => {
                if (!itemsByChild[item.childId]) {
                    itemsByChild[item.childId] = {
                        name: item.childName,
                        items: []
                    };
                }
                itemsByChild[item.childId].items.push(item);
            });
            
            let html = '';
            Object.keys(itemsByChild).sort((a, b) => parseInt(a) - parseInt(b)).forEach(childId => {
                const child = itemsByChild[childId];
                html += `<div class="child-cart-section">`;
                html += `<div class="child-cart-header">${child.name}</div>`;
                
                child.items.forEach(item => {
                    html += `
                        <div class="cart-item">
                            <div class="cart-item-name">${item.name} (${item.day})</div>
                            <div class="cart-item-price">$${item.price.toFixed(2)}</div>
                        </div>
                    `;
                });
                html += `</div>`;
            });
            
            cartItemsDiv.innerHTML = html;
            totalSpan.textContent = currentTotal.toFixed(2);
        }
        
        function validateForm() {
            const email = document.getElementById('family-email').value.trim();
            const checkoutBtn = document.getElementById('checkout-btn');
            
            // Check if we have items and required info
            const hasItems = orderItems.length > 0;
            const hasEmail = email.length > 0;
            
            // Check if all children have required info
            const children = document.querySelectorAll('.child-section');
            let allChildrenComplete = true;
            children.forEach(child => {
                const firstName = child.querySelector('.child-first-name').value.trim();
                const lastName = child.querySelector('.child-last-name').value.trim();
                const grade = child.querySelector('.child-grade').value;
                if (!firstName || !lastName || !grade) {
                    allChildrenComplete = false;
                }
            });
            
            const formValid = hasItems && hasEmail && allChildrenComplete && storeIsOpen;
            
            if (!storeIsOpen) {
                checkoutBtn.disabled = true;
                checkoutBtn.textContent = 'Store Closed';
            } else if (formValid) {
                checkoutBtn.disabled = false;
                checkoutBtn.textContent = `Review & Pay Order ($${currentTotal.toFixed(2)})`;
            } else {
                checkoutBtn.disabled = true;
                checkoutBtn.textContent = 'Complete Form to Continue';
            }
        }
        
        // ============================================
        // STORE HOURS MANAGEMENT
        // ============================================
        function checkStoreHours() {
            const now = new Date();
            const hours = now.getHours();
            const statusElement = document.getElementById('store-status');
            
            if (hours >= 8 && hours < 13) {
                storeIsOpen = false;
                statusElement.className = 'store-status store-closed';
                statusElement.textContent = '🚫 Store is CLOSED (8:00 AM - 1:00 PM). Orders will open at 1:00 PM.';
                disableOrdering(true);
            } else {
                storeIsOpen = true;
                statusElement.className = 'store-status store-open';
                const nextCutoff = hours >= 13 ? 'tomorrow at 8:00 AM' : 'today at 8:00 AM';
                statusElement.textContent = `✅ Store is OPEN! Next cutoff: ${nextCutoff}`;
                disableOrdering(false);
            }
        }
        
        function checkStoreStatusFromSheets() {
            if (!GOOGLE_SHEETS_CONFIG.webAppUrl) return;
            
            fetch(`${GOOGLE_SHEETS_CONFIG.webAppUrl}?action=status`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.status) {
                        updateStoreStatus(data.status);
                        cloudSyncActive = true;
                        updateSyncStatus();
                    }
                })
                .catch(error => {
                    console.error('Error checking store status:', error);
                    cloudSyncActive = false;
                    updateSyncStatus();
                });
        }
        
        function updateStoreStatus(status) {
            const statusElement = document.getElementById('store-status');
            
            if (status.isOpen) {
                statusElement.className = 'store-status store-open';
                statusElement.textContent = `✅ ${status.message}. Next cutoff: ${status.nextClose}`;
                disableOrdering(false);
            } else {
                statusElement.className = 'store-status store-closed';
                statusElement.textContent = `🚫 ${status.message}. Opens at ${status.nextOpen}`;
                disableOrdering(true);
            }
        }
        
        function disableOrdering(disabled) {
            const inputs = document.querySelectorAll('input, select, button');
            inputs.forEach(input => {
                if (input.id !== 'history-btn') {
                    input.disabled = disabled;
                }
            });
            
            if (disabled) {
                const checkoutBtn = document.getElementById('checkout-btn');
                checkoutBtn.textContent = 'Store Closed';
            }
        }
        
        function updateSyncStatus() {
            const indicator = document.getElementById('sync-indicator');
            const text = document.getElementById('sync-text');
            
            if (GOOGLE_SHEETS_CONFIG.useGoogleSheets && GOOGLE_SHEETS_CONFIG.webAppUrl) {
                if (cloudSyncActive) {
                    indicator.classList.remove('offline');
                    text.textContent = 'Cloud Sync Active';
                } else {
                    indicator.classList.add('offline');
                    text.textContent = 'Cloud Sync Failed';
                }
            } else {
                indicator.classList.add('offline');
                text.textContent = 'Local Storage Only';
            }
        }
        
        // ============================================
        // ORDER HISTORY & PAYMENT (Simplified for demo)
        // ============================================
        function checkOrderHistory() {
            // Simplified - would integrate with your existing history logic
            console.log('Checking order history for family email');
        }
        
        function showOrderHistory() {
            // Simplified - would show multi-child order history
            alert('Order history would show here - grouped by family email with all children');
        }
        
        function openPaymentModal() {
            const modal = document.getElementById('payment-modal');
            const modalTotal = document.getElementById('modal-total');
            const venmoTotal = document.getElementById('venmo-total');
            const venmoLink = document.getElementById('venmo-payment-link');
            
            modalTotal.textContent = currentTotal.toFixed(2);
            venmoTotal.textContent = currentTotal.toFixed(2);
            
            // Create order note with all children
            const childrenSummary = {};
            orderItems.forEach(item => {
                if (!childrenSummary[item.childName]) {
                    childrenSummary[item.childName] = [];
                }
                childrenSummary[item.childName].push(`${item.name} (${item.day})`);
            });
            
            let orderNote = `Family Lunch Order:\n`;
            Object.keys(childrenSummary).forEach(childName => {
                orderNote += `${childName}: ${childrenSummary[childName].join(', ')}\n`;
            });
            
            const venmoUrl = `venmo://paycharge?txn=pay&recipients=ChanTa-Rivers&amount=${currentTotal.toFixed(2)}&note=${encodeURIComponent(orderNote)}`;
            venmoLink.href = venmoUrl;
            
            venmoLink.onclick = function(e) {
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                
                if (!isMobile) {
                    e.preventDefault();
                    window.open('https://venmo.com/u/ChanTa-Rivers', '_blank');
                    
                    const paymentDetails = `Pay: @ChanTa-Rivers\nAmount: $${currentTotal.toFixed(2)}\nNote: ${orderNote}`;
                    
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(paymentDetails).then(() => {
                            alert('Payment details copied to clipboard!\n\n' + paymentDetails);
                        }).catch(() => {
                            alert('Please send payment to:\n\n' + paymentDetails);
                        });
                    } else {
                        alert('Please send payment to:\n\n' + paymentDetails);
                    }
                }
            };
            
            modal.style.display = 'flex';
        }
        
        function closePaymentModal() {
            document.getElementById('payment-modal').style.display = 'none';
        }
        
        function submitOrder() {
            // Create order data structure for multi-child orders
            const orderData = {
                orderId: `LO${Date.now()}${Math.random().toString(36).substr(2, 5).toUpperCase()}`,
                timestamp: new Date().toISOString(),
                email: document.getElementById('family-email').value.trim(),
                children: [],
                items: orderItems,
                total: currentTotal,
                paymentMethod: 'Venmo',
                paymentStatus: 'confirmed',
                sendConfirmation: true
            };
            
            // Add children data
            document.querySelectorAll('.child-section').forEach(child => {
                orderData.children.push({
                    id: child.dataset.child,
                    firstName: child.querySelector('.child-first-name').value.trim(),
                    lastName: child.querySelector('.child-last-name').value.trim(),
                    grade: child.querySelector('.child-grade').value
                });
            });
            
            showNotification('Submitting multi-child order...', 'info');
            
            // For demo purposes, just show success
            setTimeout(() => {
                closePaymentModal();
                showNotification(`Order ${orderData.orderId} submitted successfully!`, 'success');
                
                // Show detailed confirmation
                let confirmationMessage = `✅ ORDER CONFIRMED!\n\nOrder ID: ${orderData.orderId}\nTotal: $${orderData.total.toFixed(2)}\n\nChildren:\n`;
                orderData.children.forEach(child => {
                    confirmationMessage += `• ${child.firstName} ${child.lastName} (${child.grade})\n`;
                });
                
                alert(confirmationMessage);
                resetForm();
            }, 2000);
        }
        
        function resetForm() {
            document.getElementById('family-email').value = '';
            document.querySelectorAll('.child-first-name').forEach(input => input.value = '');
            document.querySelectorAll('.child-last-name').forEach(input => input.value = '');
            document.querySelectorAll('.child-grade').forEach(select => select.value = '');
            
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                cb.checked = false;
            });
            
            orderItems = [];
            currentTotal = 0;
            displayCart();
            validateForm();
        }
        
        function showNotification(message, type = 'info') {
            const existingNotif = document.querySelector('.notification');
            if (existingNotif) {
                existingNotif.remove();
            }
            
            let bgColor, textColor, borderColor, icon;
            switch(type) {
                case 'success':
                    bgColor = '#d4edda';
                    textColor = '#155724';
                    borderColor = '#c3e6cb';
                    icon = '✅ ';
                    break;
                case 'error':
                    bgColor = '#f8d7da';
                    textColor = '#721c24';
                    borderColor = '#f5c6cb';
                    icon = '❌ ';
                    break;
                default:
                    bgColor = '#e3f2fd';
                    textColor = '#1976d2';
                    borderColor = '#bbdefb';
                    icon = 'ℹ️ ';
            }
            
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.style.background = bgColor;
            notif.style.color = textColor;
            notif.style.border = `1px solid ${borderColor}`;
            
            notif.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>${icon}</span>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; cursor: pointer; margin-left: auto;">✕</button>
                </div>
            `;
            
            document.body.appendChild(notif);
            
            setTimeout(() => {
                if (notif.parentElement) {
                    notif.remove();
                }
            }, type === 'success' ? 3000 : 5000);
        }
        
        // Make removeChild available globally
        window.removeChild = removeChild;
    </script>
</body>
</html>
